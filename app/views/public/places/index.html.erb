<class="container-fluid mt-4">
  <h1 class="mb-4">施設・公園一覧</h1>
<!--検索-->
  <div class="card p-4 mb-4 shadow-sm">
  <div class="row g-2 align-items-center">
    <div class="col-md-8">
      <input type="text" id="keyword-search" class="form-control" placeholder="キーワードで検索（例: 渋谷 授乳室）">
    </div>
    <div class="col-md-4 text-end">
      <button class="btn btn-primary w-100" id="search-btn">検索</button>
    </div>
  </div>
</div>

<div class="card p-4 mb-4 shadow-sm">
  <form id="filter-form" class="row g-3">
    <% filters = {
      "filter_category_park" => "公園のみ",
      "filter_category_facility" => "施設のみ",
      "filter_nursery" => "授乳室あり",
      "filter_diaper" => "おむつ交換台あり",
      "filter_kidstoilet" => "幼児用トイレあり",
      "filter_stroller" => "ベビーカー対応",
      "filter_playground" => "遊具あり",
      "filter_shade" => "木陰あり",
      "filter_bench" => "ベンチあり",
      "filter_elevator" => "エレベーターあり",
      "filter_parking" => "駐車場あり"
    } %>

    <% filters.each do |id, label| %>
      <div class="col-6 col-md-3">
        <div class="form-check">
          <input type="checkbox" id="<%= id %>" class="form-check-input">
          <label for="<%= id %>" class="form-check-label"><%= label %></label>
        </div>
      </div>
    <% end %>
  </form>
</div>

  <% if user_signed_in? %>
    <div class="text-end mb-4">
      <%= link_to '施設・公園を新規登録する', new_public_place_path, class: 'btn btn-success' %>
    </div>
  <% end %>

  <!-- Google Map -->
<div id="map" class="rounded shadow-sm mb-4" style="width: 100%; height: 800px;"></div>

<!-- ピンをクリックした時に表示するバナー -->
<div id="place-info-banner" class="card shadow-lg fixed-bottom m-4 border-primary" style="display: none; max-width: 600px; z-index: 1000;">
  <div class="card-body d-flex align-items-center">
    <img id="place-photo" src="" alt="施設写真" class="me-3 rounded" style="width: 100px; height: 100px; object-fit: cover;">
    <div>
      <h5 id="place-name" class="mb-1 fw-bold"></h5>
      <p id="place-details" class="mb-1 small text-muted"></p>
      <a href="#" id="place-link" class="btn btn-sm btn-outline-primary mt-2">詳細を見る</a>
    </div>
  </div>
</div>

<%= javascript_pack_tag 'place_index_map', defer: true %>
  <script
    async defer src="https://maps.googleapis.com/maps/api/js?key=<%= ENV['GOOGLE_MAPS_API_KEY'] %>&libraries=places&callback=initMap">
  </script>      


<script>
  window.places = <%= raw @places.to_json(
    only: [:id, :name, :latitude, :longitude, :category, :nursery],
    methods: [:main_image_url, :comments_count, :likes_count, :facility_summary, :place_path]
  ) %>;  
</script>

